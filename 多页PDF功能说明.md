# 多页 PDF 翻页功能说明

## 🎉 新功能

已成功添加多页 PDF 的翻页识别和填写功能！

## ✨ 功能特点

### 1. **智能翻页**
- 自动检测 PDF 总页数
- 支持"上一页"和"下一页"按钮切换
- 实时显示当前页码（例如："第 2 页，共 5 页"）
- 单页 PDF 自动隐藏翻页按钮

### 2. **数据保存**
- 切换页面时自动保存当前页的填写内容
- 返回之前的页面时自动恢复填写的数据
- 提交时合并所有页面的数据到 PDF

### 3. **用户体验**
- 流畅的页面切换动画
- 加载提示显示当前操作页码
- 翻页按钮智能禁用（首页禁用"上一页"，末页禁用"下一页"）

## 🔄 工作流程

### 步骤 1: 上传 PDF
- 上传任意页数的 PDF 文件
- 系统自动识别第 1 页并显示字段

### 步骤 2: 填写第一页
- 填写第 1 页的表单字段
- 查看阿里云识别的中文标签

### 步骤 3: 翻页识别
- 点击"下一页"按钮
- 系统自动识别下一页的字段
- 之前填写的数据自动保存

### 步骤 4: 继续填写
- 在每一页填写相应的字段
- 可以随时返回之前的页面修改数据
- 所有数据都会保存在浏览器中

### 步骤 5: 提交生成
- 点击"生成 PDF"按钮
- 系统合并所有页面的数据
- 一次性填写整个 PDF 的所有字段
- 下载填写完成的 PDF

## 📋 界面元素

### 页面指示器
位置：表单卡片右上角
显示：`第 X 页，共 Y 页`

### 翻页按钮
位置：表单字段上方中央
包含：
- **上一页** 按钮（带左箭头图标）
- **下一页** 按钮（带右箭头图标）

### 按钮状态
- 首页时："上一页"按钮禁用
- 末页时："下一页"按钮禁用
- 只有一页时：翻页按钮自动隐藏

## 🎯 使用示例

### 示例：填写 3 页 PDF

1. **上传文件**
   - 上传 NNC1_fillable.pdf（3页）
   - 自动识别第 1 页

2. **填写第 1 页**
   ```
   第 1 页，共 3 页
   ├── 公司名称: XXX有限公司
   ├── 注册地址: 香港...
   └── ...
   ```

3. **切换到第 2 页**
   - 点击"下一页"
   - 系统识别第 2 页字段
   ```
   第 2 页，共 3 页
   ├── 電郵: example@email.com
   ├── 香港聯絡電話號碼: +852...
   └── ...
   ```

4. **切换到第 3 页**
   - 继续点击"下一页"
   - 填写第 3 页内容

5. **生成 PDF**
   - 点击"生成 PDF"
   - 下载包含所有页面数据的完整 PDF

## 🔧 技术实现

### 后端 API

#### 1. 获取 PDF 信息
```
POST /get-pdf-info
Body: {"file_id": "..."}
Response: {
    "success": true,
    "total_pages": 3,
    "file_name": "document.pdf"
}
```

#### 2. 解析指定页面
```
POST /parse-pdf-by-id
Body: {
    "file_id": "...",
    "page_num": 2  // 从 1 开始
}
Response: {
    "fields": [...],
    "current_page": 2,
    "total_pages": 3
}
```

### 前端逻辑

#### 数据结构
```javascript
let currentPage = 1;           // 当前页码
let totalPages = 1;            // 总页数
let allPagesData = {           // 所有页面的数据
    1: { field1: "value1", ... },
    2: { field2: "value2", ... },
    3: { field3: "value3", ... }
};
```

#### 关键函数
- `handlePrevPage()`: 处理上一页
- `handleNextPage()`: 处理下一页
- `loadPage(pageNum)`: 加载指定页面
- `saveCurrentPageData()`: 保存当前页数据
- `restorePageData(pageNum)`: 恢复页面数据
- `updatePageIndicator()`: 更新页面指示器
- `updatePaginationButtons()`: 更新按钮状态

## 📝 注意事项

1. **数据保存**
   - 页面数据保存在浏览器内存中
   - 刷新页面会丢失数据
   - 建议一次性完成填写

2. **阿里云识别**
   - 每次翻页都会调用阿里云视觉识别
   - 可能需要几秒钟时间
   - 请耐心等待加载完成

3. **页码范围**
   - 页码从 1 开始
   - 不能跳过页面
   - 必须按顺序浏览

4. **提交时机**
   - 可以随时提交
   - 未填写的页面会跳过
   - 只提交有数据的字段

## 🐛 故障排除

### 问题 1：翻页按钮无响应
**解决方案**：
- 检查浏览器控制台是否有错误
- 确认是否在首页/末页（按钮会禁用）
- 刷新页面重新开始

### 问题 2：数据丢失
**解决方案**：
- 翻页前数据会自动保存
- 如果数据丢失，检查控制台日志
- 避免刷新页面

### 问题 3：识别时间过长
**解决方案**：
- 阿里云识别需要时间处理
- 等待加载提示消失
- 检查网络连接

### 问题 4：页面显示错误
**解决方案**：
- 使用 `forceCloseLoading()` 关闭加载层
- 刷新页面重新开始
- 检查 PDF 文件是否损坏

## 📊 测试清单

- [x] 单页 PDF（翻页按钮自动隐藏）
- [x] 多页 PDF（显示翻页按钮）
- [x] 首页禁用"上一页"
- [x] 末页禁用"下一页"
- [x] 数据保存和恢复
- [x] 页面指示器显示
- [x] 合并所有页面数据提交
- [x] 下载完整 PDF

## 🎨 界面预览

```
┌─────────────────────────────────────────┐
│ 📝 填写表单字段    第 2 页，共 3 页 🔵 │
├─────────────────────────────────────────┤
│ ℹ️ 已使用阿里云视觉识别自动识别字段标签  │
│                                         │
│  ◀️ 上一页    |    下一页 ▶️            │
│                                         │
│ 📝 fill_1_P.2 (電郵)                    │
│ [                                    ]  │
│                                         │
│ 📝 fill_2_P.2 (香港聯絡電話號碼)         │
│ [                                    ]  │
│                                         │
│ ◀️ 重新上传         生成PDF ✅           │
└─────────────────────────────────────────┘
```

## 🚀 未来改进

- [ ] 支持页面跳转（直接输入页码）
- [ ] 显示每页填写进度
- [ ] 支持批量填写相同字段
- [ ] 添加字段预览功能
- [ ] 支持导入/导出填写数据

## 📞 技术支持

如遇问题，请检查：
1. 浏览器控制台（F12）查看错误
2. 服务器日志查看详细信息
3. API 文档: http://127.0.0.1:8000/docs
